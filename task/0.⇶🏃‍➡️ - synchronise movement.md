Synchronise movement
====================


Get a basic game-loop going to synchronise moves


```
2026-01-17		new task 	‚á∂üèÉ‚Äç‚û°Ô∏è
```


Everything is obviously a mega mess right now, cleaning as I go.


Space parameters
----------------

Moved some more stuff to html-common that will *hopefully* end up good enough to serve the other projects.
For now this is the only project using the html-common version of PlanarSpace, so will try out a few things, and try to keep it in step with Turtle until it's ready to switch over to the shared version.

One thing I need here that has been languishing in Turtle is space size parameters.
I'll try to use 'size' rather than dimensions for these kinds of uses as dimensions more properly refer to things like X, Y and Z - 1D, 2D, 3D etc.

In turtle so far size parameters have been 'soft' - extents aren't really limited, it just determines how the grid gets drawn.
For wormfarm I need to be able to tie this down in various ways; not going put the hard movement limits in yet, just want to figure out how to specify them.

There are actually quite a few potential space parameters I've pondered, but here are main ones for now:
* x extent				- x min, x max
* y extent				- y min, y max
* polar axis			- vertical up / right horizontal
* polar directiom		- clockwise / ccw
* resolution/precision	- decimal places, significant figures (very much needs attention)

So how to specify these for new space instances?
My first thought is that each space module defines it's own parameter structure type, so that the space constructor looks like `new FooSpace('myFooSpace', parameters)` everywhere.
If that typechecks okay...

Will move parts of this job to `html-common`, but do some of the testing in here - if I can switch this project to use that branch for the time being...



### SVG/Space mapping

After a bunch of hacking here and over in html-common finally getting a little bit somewhere.

But I really need to figure out some sort of way of mapping abstract planar spaces to SVG drawing spaces.

At it's simplest I think it could just be a function that performs a coordinate transform... put coordinates in, get transformed coordinates out.
Though I might be able to tap into some of the web api transform matrix stuff:
* https://developer.mozilla.org/en-US/docs/Web/API/SVGTransform/matrix
* https://developer.mozilla.org/en-US/docs/Web/API/DOMMatrix

I've already used some of it in click controller(s):

```js
	const domPoint = new DOMPoint(event.clientX, event.clientY);
	const spaceElement = this.element.svg.getElementById('group-space');
	// Get point in SVG space coordinates
	const spacePoint = domPoint.matrixTransform(spaceElement.getScreenCTM().inverse());
```
But that was mostly just adapted from stuff on SO, prob need to to dig a little deeper this time.
There are actually quite a few interesting sounding objects and interfaces in there (eg DOMRect, DOMQuad) - should do some experimenting.


Return after a little bit
-------------------------

Okay have been away from this for while, mostly hacking in html experiment and common to get them into a nicer state.

I've started some experiments with `DOMMatrix` and i think I'll be able to get it going for what I need here.
For now I think all i need is a basic inversion to map from my planar space to svg space, but there's stacks of potential for other kinds of stuff.




